---
- name: Crear la PDB INSTITUTO en la CDB FREE
  ansible.builtin.shell: |
    export ORACLE_HOME=/opt/oracle/product/23ai/dbhomeFree
    export PATH=$ORACLE_HOME/bin:$PATH
    export ORACLE_SID=FREE
    echo "
    ALTER SESSION SET CONTAINER=CDB$ROOT;
    ALTER SYSTEM SET db_create_file_dest = '/opt/oracle/oradata/FREE' SCOPE=BOTH;
    CREATE PLUGGABLE DATABASE INSTITUTO
      ADMIN USER instituto_admin IDENTIFIED BY Oracle123;
    ALTER PLUGGABLE DATABASE INSTITUTO OPEN;
    " | $ORACLE_HOME/bin/sqlplus -s sys/Oracle123@FREE as sysdba
  become_user: oracle

- name: Crear tabla y registros en la PDB INSTITUTO
  ansible.builtin.shell: |
    export ORACLE_HOME=/opt/oracle/product/23ai/dbhomeFree
    export PATH=$ORACLE_HOME/bin:$PATH
    export ORACLE_SID=FREE
    echo "
    ALTER SESSION SET CONTAINER=INSTITUTO;
    CREATE TABLE profesores (
      id_profesor NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      nombre VARCHAR2(100),
      especialidad VARCHAR2(100)
    );

    INSERT INTO profesores (nombre, especialidad) VALUES ('Alejandro Roca Alhama', 'Sistemas');
    INSERT INTO profesores (nombre, especialidad) VALUES ('Jose Antonio Moñino', 'Aplicaciones Web');
    INSERT INTO profesores (nombre, especialidad) VALUES ('Antonio Pelegrin', 'Servicios en Red');
    INSERT INTO profesores (nombre, especialidad) VALUES ('Cayetano Reinaldos Duarte', 'Base de datos');
    INSERT INTO profesores (nombre, especialidad) VALUES ('Samuel Rabadan', 'Seguridad Informática');
    INSERT INTO profesores (nombre, especialidad) VALUES ('Miguel Angel Ibañez', 'Redes');

    COMMIT;
    " | $ORACLE_HOME/bin/sqlplus -s sys/Oracle123@FREE as sysdba
  become_user: oracle
